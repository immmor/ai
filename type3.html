<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Flow | Master Edition</title>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --text-dim: #333;
            --text-bright: #fff;
            --accent-color: #00f3ff; /* èµ›åšè“ */
            --secondary-color: #bc13fe; /* éœ“è™¹ç´« */
            --fever-color: #ffcc00; /* ç‹‚çƒ­é‡‘ */
            --error-color: #ff0055;  /* æ•…éšœçº¢ */
            --cursor-color: #ffe600; /* äº®é»„å…‰æ ‡ */
        }

        body {
            margin: 0;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-bright);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* é˜²æ­¢ç²’å­æ’‘å¼€æ»šåŠ¨æ¡ */
            user-select: none;
            transition: background-color 0.5s;
        }

        /* --- é¡¶éƒ¨ç»éªŒæ¡ --- */
        .xp-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: #222;
            z-index: 100;
        }
        .xp-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent-color), var(--secondary-color));
            box-shadow: 0 0 10px var(--accent-color);
            transition: width 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .level-badge {
            position: fixed;
            top: 15px;
            right: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-color);
            text-shadow: 0 0 10px var(--accent-color);
        }

        /* --- æ¸¸æˆä¸»åŒºåŸŸ --- */
        .game-container {
            width: 80%;
            max-width: 900px;
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .stage-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 40px;
            opacity: 0.8;
        }

        .stage-dot {
            padding: 4px 12px;
            border: 1px solid #333;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #555;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stage-dot.active {
            border-color: var(--accent-color);
            color: var(--accent-color);
            background: rgba(0, 243, 255, 0.1);
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
        }

        /* --- æ–‡å­—æ˜¾ç¤º --- */
        .word-display {
            font-size: 2.5rem;
            line-height: 1.6;
            font-weight: bold;
            margin-bottom: 30px;
            position: relative;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
            min-height: 80px;
        }

        .char {
            color: var(--text-dim);
            transition: color 0.1s, text-shadow 0.1s;
            position: relative;
            white-space: pre;
            border-bottom: 2px solid transparent;
        }

        .char.masked { color: transparent; border-bottom: 2px dashed #333; }
        .char.correct {
            color: var(--accent-color) !important;
            text-shadow: 0 0 10px var(--accent-color);
            border-bottom-color: transparent !important;
        }
        .char.wrong {
            color: var(--error-color) !important;
            text-shadow: 0 0 10px var(--error-color);
            background-color: rgba(255, 0, 85, 0.1);
        }
        
        .char.active {
            border-bottom: 2px solid var(--cursor-color) !important;
            animation: blink 1s infinite;
        }
        .char.hint-reveal {
            color: rgba(255, 255, 255, 0.5) !important;
            animation: fadeInOut 1s forwards;
        }

        /* é»˜å†™æ¨¡å¼ */
        .word-display.blind-mode .char:not(.correct):not(.wrong) { color: transparent; border-bottom: none; }
        .word-display.blind-mode::after {
            content: "[ BLIND MODE ]";
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 1.5rem; color: #333; pointer-events: none;
        }
        .word-display.blind-mode.typing::after { opacity: 0; }

        /* --- ç¿»è¯‘ä¸åé¦ˆ --- */
        .translation {
            font-size: 1.3rem;
            color: #888;
            margin-top: 10px;
            font-family: "Microsoft YaHei", sans-serif;
            min-height: 1.5em;
            transition: color 0.3s;
        }

        /* --- HUD --- */
        .hud {
            display: flex;
            gap: 40px;
            margin-top: 50px;
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 2px;
            justify-content: center;
        }
        .hud-item b {
            color: #fff;
            font-size: 1.4rem;
            display: block;
            margin-top: 5px;
        }

        /* --- ç²’å­ç‰¹æ•ˆå®¹å™¨ --- */
        #particles {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 20;
        }

        .particle {
            position: absolute;
            width: 4px; height: 4px;
            background: var(--accent-color);
            border-radius: 50%;
            animation: pop 0.6s ease-out forwards;
        }

        /* --- ç‹‚çƒ­æ¨¡å¼æ ·å¼ --- */
        body.fever-mode {
            --accent-color: var(--fever-color);
            /* background-color: #1a1100; å¾®å¼±çš„èƒŒæ™¯è‰²å˜åŒ– */
        }
        body.fever-mode .combo-bg {
            color: rgba(255, 204, 0, 0.1);
            text-shadow: 0 0 30px var(--fever-color);
        }

        /* --- æç¤ºæ  --- */
        .footer-hint {
            position: fixed;
            bottom: 15px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 15px;
            font-size: 12px;
            color: #666;
            z-index: 100;
        }
        
        .footer-hint span {
            cursor: pointer;
            padding: 3px 6px;
            border-radius: 3px;
            transition: background-color 0.2s, color 0.2s;
        }
        
        .footer-hint span:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--accent-color);
        }
        .key-tag {
            background: #222;
            padding: 1px 3px;
            border-radius: 2px;
            color: #999;
            border: 1px solid #333;
            font-size: 10px;
        }

        /* --- åŠ¨ç”» --- */
        .combo-bg {
            position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 15rem; color: rgba(255, 255, 255, 0.02);
            z-index: -1; font-weight: 900; pointer-events: none;
            transition: all 0.2s;
        }

        @keyframes blink {
            0%, 100% { border-bottom-color: var(--cursor-color); box-shadow: 0 2px 5px var(--cursor-color); }
            50% { border-bottom-color: transparent; box-shadow: none; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-4px); }
            40% { transform: translateX(4px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }
        .shake-screen { animation: shake 0.3s ease-in-out; }
        @keyframes pop {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }
        @keyframes fadeInOut {
            0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; }
        }
        @keyframes levelUpAnim {
            0% { transform: scale(1); } 50% { transform: scale(1.5); color: #fff; } 100% { transform: scale(1); }
        }

        #input-field { opacity: 0; position: absolute; top: -1000px; }

    </style>
</head>
<body>

    <div class="xp-container"><div class="xp-bar" id="xp-bar"></div></div>
    <div class="level-badge" id="level-badge">LV.1</div>
    <div id="particles"></div>
    <div class="combo-bg" id="combo-bg">0</div>

    <div class="game-container">
        <div class="stage-indicator" id="stage-indicator"></div>

        <div class="word-display" id="word-display">Press Any Key</div>
        <div class="translation" id="translation">ç‚¹å‡»å¼€å§‹ â€¢ è¿›å…¥å¿ƒæµçŠ¶æ€</div>

        <div class="hud">
            <div class="hud-item">Score <b id="score">0</b></div>
            <div class="hud-item">Combo <b id="combo">0</b></div>
            <div class="hud-item">WPM <b id="wpm">0</b></div>
        </div>
    </div>

    <div class="footer-hint">
        <span id="hint-button"><span class="key-tag">Shift + I</span> æç¤º (-50åˆ†)</span>
        <span id="read-button"><span class="key-tag">Shift + R</span> æœ—è¯»</span>
        <span id="skip-button"><span class="key-tag">Shift + N</span> è·³è¿‡</span>
        <span><span class="key-tag">è‡ªåŠ¨é€€æ ¼ä¿®æ­£</span></span>
    </div>
    
    <input type="text" id="input-field" autocomplete="off">

    <script src="words.js"></script>
    <script>
        // --- 1. æ ¸å¿ƒå˜é‡ ---
        let lessonQueue = [];
        let currentStep = null;
        
        let state = {
            score: 0,
            combo: 0,
            maxCombo: 0,
            hits: 0,
            misses: 0,
            xp: 0,
            level: 1,
            nextLevelXp: 1000
        };
        
        let startTime = 0;
        let typedChars = 0;

        let isGameActive = false;
        
        // --- 2. éŸ³é¢‘ç³»ç»Ÿ (å¢å¼ºç‰ˆ) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            
            if (type === 'success') {
                // å°å…³å¡æˆåŠŸ
                playSoundNote(880, now, 0.1); 
                setTimeout(() => playSoundNote(1108.73, now + 0.1, 0.15), 50); 
            } else if (type === 'complete') {
                // æ•´å¥å®Œæˆï¼ˆæ›´åä¸½çš„å£°éŸ³ï¼‰
                playSoundNote(523.25, now, 0.1); // C5
                setTimeout(() => playSoundNote(659.25, now + 0.1, 0.1), 100); // E5
                setTimeout(() => playSoundNote(783.99, now + 0.2, 0.3), 200); // G5
            } else {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);

                // ç‹‚çƒ­æ¨¡å¼éŸ³è°ƒæ›´é«˜
                let pitchMod = state.combo > 20 ? 1.2 : 1.0;

                if (type === 'type') {
                    // æœºæ¢°é”®ç›˜å£° (æ¸…è„†)
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(600 * pitchMod, now);
                    osc.frequency.exponentialRampToValueAtTime(300, now + 0.05);
                    gain.gain.setValueAtTime(0.15, now); // ç¨å¾®å¤§å£°ä¸€ç‚¹
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                    osc.start(now);
                    osc.stop(now + 0.05);
                } else if (type === 'error') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.linearRampToValueAtTime(50, now + 0.15);
                    gain.gain.setValueAtTime(0.2, now);
                    gain.gain.linearRampToValueAtTime(0.01, now + 0.15);
                    osc.start(now);
                    osc.stop(now + 0.15);
                } else if (type === 'levelup') {
                    // å‡çº§éŸ³æ•ˆ (çˆ¬å‡éŸ³)
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(440, now);
                    osc.frequency.linearRampToValueAtTime(880, now + 0.1);
                    osc.frequency.linearRampToValueAtTime(1760, now + 0.3);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.5);
                    osc.start(now);
                    osc.stop(now + 0.5);
                }
            }
        }
        
        function playSoundNote(freq, time, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.type = 'sine';
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.1, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + duration);
            osc.start(time);
            osc.stop(time + duration);
        }

        // --- 3. è§†è§‰ç‰¹æ•ˆç³»ç»Ÿ ---
        function spawnParticles(rect) {
            const container = document.getElementById('particles');
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            const color = state.combo > 20 ? 'var(--fever-color)' : 'var(--accent-color)';

            // ç”Ÿæˆ 5-8 ä¸ªç²’å­
            for (let i = 0; i < 6; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                p.style.backgroundColor = color;
                
                // éšæœºçˆ†ç‚¸æ–¹å‘
                const angle = Math.random() * Math.PI * 2;
                const velocity = 30 + Math.random() * 50;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                
                p.style.setProperty('--tx', `${tx}px`);
                p.style.setProperty('--ty', `${ty}px`);
                
                container.appendChild(p);
                setTimeout(() => p.remove(), 600);
            }
        }

        // --- 4. æ¸¸æˆé€»è¾‘ ---
        const displayEl = document.getElementById('word-display');
        const inputEl = document.getElementById('input-field');
        const scoreEl = document.getElementById('score');
        const comboEl = document.getElementById('combo');
        const bgEl = document.getElementById('combo-bg');
        const wpmEl = document.getElementById('wpm');
        const xpBar = document.getElementById('xp-bar');
        const levelEl = document.getElementById('level-badge');
        const stageIndEl = document.getElementById('stage-indicator');

        function speakCurrentText() {
            const u = new SpeechSynthesisUtterance(currentStep.text);
            u.lang = 'en-US';
            window.speechSynthesis.speak(u);
        }
        
        function initGame() {
            document.addEventListener('click', () => {
                inputEl.focus();
                if(audioCtx.state === 'suspended') audioCtx.resume();
            });
            document.addEventListener('keydown', () => inputEl.focus());
            
            // ä¸ºåº•éƒ¨æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.getElementById('hint-button').addEventListener('click', showHint);
            document.getElementById('read-button').addEventListener('click', speakCurrentText);
            document.getElementById('skip-button').addEventListener('click', loadNextStep);
            
            startNewSentence();
        }
        
        function updateWPM() {
            if (!isGameActive) return;
            const timeElapsedMin = (Date.now() - startTime) / 60000;
            if (timeElapsedMin > 0) {
                const wpm = Math.round((typedChars / 5) / timeElapsedMin);
                wpmEl.innerText = wpm;
            }
            requestAnimationFrame(updateWPM);
        }
        
        function shakeScreen() {
            document.body.classList.add('shake-screen');
            setTimeout(() => document.body.classList.remove('shake-screen'), 300);
        }

        function generateLessonPlan(sentenceObj) {
            const plan = [];
            const words = sentenceObj.en.split(' ');
            
            // éš¾è¯æå– (é•¿åº¦>4)
            let hardWords = words
                .filter(w => w.replace(/[^a-zA-Z]/g, '').length > 4)
                .sort((a, b) => b.length - a.length)
                .slice(0, 2); // åªè¦æœ€éš¾çš„2ä¸ªï¼Œé¿å…å¤ªé•¿
            
            hardWords.forEach(word => {
                const cleanWord = word.replace(/[^a-zA-Z0-9]/g, '');
                if(cleanWord.length > 0) {
                    plan.push({
                        text: cleanWord,
                        mode: 'word',
                        label: 'âš¡ Warm-up',
                        translation: `[ é¢„çƒ­ ] é‡ç‚¹è¯æ±‡: ${cleanWord}`
                    });
                }
            });

            // å¡«ç©º
            let maskIndices = [];
            hardWords.forEach(hw => {
                let idx = sentenceObj.en.indexOf(hw);
                if (idx !== -1) {
                    for(let i=0; i<hw.length; i++) maskIndices.push(idx + i);
                }
            });

            plan.push({
                text: sentenceObj.en,
                mode: 'cloze',
                label: 'ğŸ§© Cloze',
                maskIndices: maskIndices,
                translation: sentenceObj.cn
            });

            // é»˜å†™
            plan.push({
                text: sentenceObj.en,
                mode: 'blind',
                label: 'ğŸ§  Recall',
                translation: sentenceObj.cn
            });

            return plan;
        }

        function startNewSentence() {
            const targetObj = contentList[Math.floor(Math.random() * contentList.length)];
            lessonQueue = generateLessonPlan(targetObj);
            loadNextStep();
        }

        function loadNextStep() {
            if (lessonQueue.length === 0) {
                // å¥å­å®Œæˆå¥–åŠ±
                addXP(100);
                playSound('complete');
                setTimeout(startNewSentence, 800);
                return;
            }

            currentStep = lessonQueue.shift();
            inputEl.value = '';
            
            // æ¸²æŸ“æ­¥éª¤æ¡
            stageIndEl.innerHTML = '';
            const dot = document.createElement('div');
            dot.className = 'stage-dot active';
            dot.innerText = currentStep.label;
            stageIndEl.appendChild(dot);

            renderUI();
            
            if (!isGameActive) {
                startTime = Date.now();
                isGameActive = true;
                requestAnimationFrame(updateWPM);
            }
        }

        function renderUI() {
            displayEl.innerHTML = '';
            displayEl.className = 'word-display'; 
            const transEl = document.getElementById('translation');
            transEl.className = 'translation';
            
            if (currentStep.mode === 'blind') {
                displayEl.classList.add('blind-mode');
                transEl.classList.add('highlight'); // é«˜äº®ä¸­æ–‡
            }

            transEl.innerText = currentStep.translation;

            currentStep.text.split('').forEach((char, index) => {
                const span = document.createElement('span');
                span.innerText = char;
                span.classList.add('char');
                if (currentStep.mode === 'cloze' && currentStep.maskIndices && currentStep.maskIndices.includes(index)) {
                    span.classList.add('masked');
                }
                if (index === 0) span.classList.add('active');
                displayEl.appendChild(span);
            });
        }

        // --- æ ¸å¿ƒè¾“å…¥ç›‘å¬ ---
        inputEl.addEventListener('input', (e) => {
            const val = inputEl.value;
            const spans = displayEl.querySelectorAll('.char');
            
            // ç›²æ‰“æ¨¡å¼å¼€å§‹åéšè—æç¤º
            if (currentStep.mode === 'blind' && val.length > 0) {
                displayEl.classList.add('typing');
            }

            if (e.inputType !== "deleteContentBackward") {
                playSound('type');
                state.hits++;
                
                // è·å–å…‰æ ‡ä½ç½®çš„å…ƒç´ ç”¨äºç”Ÿæˆç²’å­
                const currentSpan = spans[val.length - 1];
                if (currentSpan) {
                    const rect = currentSpan.getBoundingClientRect();
                    spawnParticles(rect); // âœ¨ ç”Ÿæˆç²’å­
                }
            }

            let allCorrectSoFar = true;

            spans.forEach((span, index) => {
                span.classList.remove('active');

                if (index < val.length) {
                    if (val[index] === currentStep.text[index]) {
                        span.className = 'char correct';
                    } else {
                        span.className = 'char wrong';
                        allCorrectSoFar = false;
                        if (e.inputType !== "deleteContentBackward" && index === val.length - 1) {
                            playSound('error');
                            resetCombo();
                            shakeScreen();
                        }
                    }
                } else {
                    span.className = 'char';
                    if (currentStep.mode === 'cloze' && currentStep.maskIndices.includes(index)) {
                        span.classList.add('masked');
                    }
                }
            });

            if (val.length < spans.length) {
                spans[val.length].classList.add('active');
            }

            // æ£€æŸ¥å®Œæˆ
            if (val === currentStep.text) {
                handleSuccess();
            }
        });

        function handleError() {
            // è¿™ä¸ªå‡½æ•°å¯èƒ½ä¸å†éœ€è¦ï¼Œå› ä¸ºé”™è¯¯å¤„ç†å·²ç§»è‡³ input äº‹ä»¶ä¸­
            state.misses++;
            updateHUD();
            document.body.classList.remove('fever-mode'); // é€€å‡ºç‹‚çƒ­
        }
        
        function resetCombo() {
            state.combo = 0;
            bgEl.style.opacity = 0;
            updateHUD();
        }

        function handleSuccess() {
            playSound('success');
            
            let stepBonus = currentStep.mode === 'blind' ? 100 : (currentStep.mode === 'cloze' ? 50 : 20);
            state.score += stepBonus + state.combo;
            state.combo++;
            typedChars += currentStep.text.length;
            
            if(state.combo > state.maxCombo) state.maxCombo = state.combo;

            // ç‹‚çƒ­æ¨¡å¼åˆ¤å®š
            if (state.combo >= 20) {
                document.body.classList.add('fever-mode');
            }

            addXP(10);
            updateHUD();
            triggerComboEffect();
            setTimeout(loadNextStep, 300);
        }
        
        function triggerComboEffect() {
            // ç®€å•è§†è§‰åé¦ˆ
        }

        function addXP(amount) {
            state.xp += amount;
            if (state.xp >= state.nextLevelXp) {
                state.xp -= state.nextLevelXp;
                state.level++;
                state.nextLevelXp = Math.floor(state.nextLevelXp * 1.2); // å‡çº§éš¾åº¦å¢åŠ 
                playSound('levelup');
                levelEl.innerText = "LV." + state.level;
                levelEl.style.animation = 'levelUpAnim 0.5s';
                setTimeout(() => levelEl.style.animation = '', 500);
            }
            
            const pct = (state.xp / state.nextLevelXp) * 100;
            xpBar.style.width = `${pct}%`;
        }

        function updateHUD() {
            scoreEl.innerText = state.score;
            comboEl.innerText = state.combo;
            
            if (state.combo > 0) {
                bgEl.innerText = state.combo;
                bgEl.style.opacity = Math.min(state.combo * 0.05, 0.3);
                bgEl.style.transform = "translate(-50%, -50%) scale(1.2)";
                setTimeout(() => bgEl.style.transform = "translate(-50%, -50%) scale(1)", 100);
            } else {
                bgEl.style.opacity = 0;
            }
        }

        // --- æç¤ºåŠŸèƒ½ ---
        function showHint() {
            const val = inputEl.value;
            if (val.length >= currentStep.text.length) return;
            
            const nextChar = currentStep.text[val.length];
            const spans = displayEl.querySelectorAll('.char');
            const targetSpan = spans[val.length];

            // æ‰£åˆ†
            state.score = Math.max(0, state.score - 50);
            updateHUD();

            // è§†è§‰æç¤º (ä¸´æ—¶æ˜¾ç¤ºå­—ç¬¦)
            targetSpan.innerText = nextChar;
            targetSpan.classList.add('hint-reveal');
            
            // 1ç§’åå¦‚æœè¿˜æ²¡è¾“å…¥ï¼Œæ¢å¤åŸæ · (é™¤äº†blind modeç‰¹æ®Šå¤„ç†)
            setTimeout(() => {
                targetSpan.classList.remove('hint-reveal');
                if (currentStep.mode === 'blind' && !targetSpan.classList.contains('correct')) {
                     // Blind mode ä¸‹æç¤ºæ¶ˆå¤±ååº”è¯¥å˜å›ç©º/é€æ˜ï¼Œä½†ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œè¿™é‡Œæˆ‘ä»¬è®©å®ƒä¿æŒä¸å¯è§ç›´åˆ°ç”¨æˆ·è¾“å…¥
                     // å…¶å® CSS class .char æ²¡æœ‰æ–‡å­—å†…å®¹å˜åŒ–ï¼Œè¿™é‡Œ innerText æ”¹å˜äº†
                }
            }, 800);
        }

        // --- å¿«æ·é”®ç³»ç»Ÿ ---
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') location.reload();
            
            // Hint: Shift + I
            if ((e.key === 'i' || e.key === 'I') && e.shiftKey) {
                e.preventDefault();
                showHint();
            }

            // Skip: Shift + N
            if (e.key.toLowerCase() === 'n' && e.shiftKey) {
                e.preventDefault();
                state.combo = 0; 
                document.body.classList.remove('fever-mode');
                startNewSentence(); 
            } 

            // Read: Shift + R
            if (e.key.toLowerCase() === 'r' && e.shiftKey) {
                e.preventDefault();
                const u = new SpeechSynthesisUtterance(currentStep.text);
                u.lang = 'en-US';
                window.speechSynthesis.speak(u);
            }
        });

        initGame();

    </script>
</body>
</html>